<#include "action_bar.html" />
<#include "view_customer_tabs.html" />
<#include "demands_utils.html" />
<@actionMenu panels=panels customer=customer />
<div class="gru-wrapper">
  <div id="customer-panel" class="row bg-gru-dark">
    <div class="col-xs-9 col-sm-offset-1 col-sm-7">
      <@customerDetails customer=customer />
    </div>
    <div id="header-right" class="col-xs-3 col-sm-2">
      <p>
        <a class="btn btn-border btn-block" title=" Modifier" href="jsp/admin/plugins/gru/ManageCustomers.jsp?plugin_name=gru&view=modifyCustomer&id_customer=${customer.id}">
          <i class="fa fa-pencil"></i> <span class="hidden-xs hidden-sm">#i18n{gru.view_customer_demand.header.right.edit.profil}</span>
        </a>
      </p>
      <ul class="list-unstyled">
        <li class="dropdown" >
          <a href="#" id="demandeTab" class="dropdown-toggle btn btn-border btn-block" data-toggle="dropdown" aria-controls="demandeTab-contents" aria-expanded="false">
            <i class="fa fa-plus-circle fa-fw"></i> <span class="hidden-xs hidden-sm">#i18n{gru.view_customer_tabs.tabNewDemands}</span> <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" aria-labelledby="demandeTab" id="demandeTab-contents">
            <li>
              <a href="jsp/admin/plugins/ticketing/ManageTickets.jsp?view=createTicket&cid=${customer.id!}&fn=${customer.firstname!}&ln=${customer.lastname!}&ut=${customer.idTitle!}&guid=${customer.accountGuid!}&ph=${customer.mobilePhone!}&em=${customer.email!}"
                return-url="${return_url}" >
                <i class="fa fa-bullhorn"></i> #i18n{gru.view_customer_demand.header.right.new.demand}
              </a>
            </li>
            <li>
              <a href="jsp/admin/plugins/gru/ManageCustomers.jsp?view=viewCustomerNewDemands&id_customer=${customer.id}#espacepublic">
                <i class="fa fa-street-view"></i> #i18n{gru.view_customer_demand.header.right.public.space}
              </a>
            </li>
            <li>
              <a href="jsp/admin/plugins/gru/ManageCustomers.jsp?view=viewCustomerNewDemands&id_customer=${customer.id}#voirie">
                <i class="fa fa-car"></i> #i18n{gru.view_customer_demand.header.right.voirie}
              </a>
            </li>
            <li>
              <a href="jsp/admin/plugins/gru/ManageCustomers.jsp?view=viewCustomerNewDemands&id_customer=${customer.id}#urbanisme">
                <i class="fa fa-building"></i> #i18n{gru.view_customer_demand.header.right.urbanisme}
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <div id="demand-panel" class="row bg-gru-dark gru">
    <div class="col-xs-12 col-sm-12">
        <@tabs tab="demands" customer=customer />
        <div class="tab-content">
          <div class="row">
            <div class="col-xs-12 col-sm-offset-1 col-sm-10">
            <#if demands_list?size &gt; 0 >
            <div role="tabpanel" class="tab-pane active">
              <table class="table table-striped table-hover">
                <thead>
                <tr>
                  <th class="col-xs-12 col-sm-2">#i18n{gru.view_customer_demand.demand.panel.list.reference}</th>
                  <th class="col-xs-12 col-sm-2">#i18n{gru.view_customer_demand.demand.panel.list.open.since}</th>
                  <th class="col-xs-12 col-sm-8">#i18n{gru.view_customer_demand.demand.panel.list.demand.type}</th>
                </tr>
              </thead>
              <tbody>
                <#list demands_list as demand>
                  <tr data-url="jsp/admin/plugins/gru/ManageCustomers.jsp?view=viewDemand&id_demand=${demand.id}&id_demand_type=${demand.demandTypeId}&id_customer=${customer.id}">
                    <td class="text-center">
                      <a href="jsp/admin/plugins/gru/ManageCustomers.jsp?view=viewDemand&id_demand=${demand.id}&id_demand_type=${demand.demandTypeId}&id_customer=${customer.id}">
                          ${demand.reference}
                      </a>
                    </td>
                   
                    <td class="text-gru">
                        <#if creation_date_as_date >  
                            <#assign time_ms = .now?long - demand.timeOpenedInMs?long>                 
                                 ${time_ms?number_to_datetime?string["dd/MM/yyyy HH:mm"]}
                           <#else>
                      ${displayTimeOpenedTicket2(demand.timeOpenedInMs)}
                    </#if>                   
                    </td> 
                 <td class="text-demand">${demand.title}</td>
                  </tr>
                </#list>
              </tbody>
              </table>
            </div>
            <#else>
              <div id="no-content" >
                <h2 class="text-muted">#i18n{gru.view_customer_demand.no.content}</h2>
                <img class="img-responsive" src="images/admin/skin/plugins/gru/no_user.jpg" alt="No content" title="">
              </div>
            </#if>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="js/plugins/gru/gru.js"></script>
<script>
    $(function () {
        $(".content-header").toggle();
        // Set link on whole tr
        $("tr").on('click', function(e){
        	redirectOnClick(this);
        });
    });
</script>
